# invest_backend

Это бекенд для двух клиентов — телеграм бота и сайта

- [Список команд бота](#Список-команд-для-бота)
- [Функции сайта](#Функции-сайта)
- [Переменные окружения](#Бекенду-нужно-передать-четыре-переменные-окружения)
- [Сборка образа](#Команда-для-сборки-бекенда-в-докер-образ)
- [Запуск контейнера](#Команда-для-запуска-контейнера-с-бекендом)

### Список команд для бота

```
/getBalance - Узнать баланс (доход за всё время)
/getPortfolio - Получить ожидаемый доход по каждой бумаге в портфеле
/getOrders - Получить список активных заявок
/getCurrencyPrice USD|EUR - Получить посленюю цену валюты
/getStockPrice %ticker% - Получить последнюю цену бумаги по тикеру
/cancel_order %order_id% - Отменить заявку. order_id можно взять из /getOrders
/placeLimitOrder %ticker% %count% %sell|buy% %price% - Разместить лимитную заявку. Порядок параметров важен, регистр нет. Пример - /place_limit_order ozon 1 sell 4200
/placeMarketOrder %ticker% %count% %sell|buy% - Разместить рыночную заявку. Порядок параметров важен, регистр нет. Пример - /place_market_order ozon 1 sell
/getHelp - Вывести список всех команд
```

### Функции сайта

- Продажа и покупка бумаг
- Отображение портфеля
- Список лимитных заявок
- Стакан заявок
- Избранное

### Бекенду нужно передать четыре переменные окружения

```
APP_NAME=Имя сервиса
BOT_TOKEN=токен телеграм бота
OWNER_ID - id владельца бота в телеграме. В телеграме все боты публичные. То есть обращаться к ним может кто угодно. Поэтому нужно указывать id владельца, чтобы управлять ботом мог только владелец бота
secretToken - токен Тинькофф Инвестиций
```

Если запускать сразу и бекенд и фронтенд через docker-compose, то можно положить рядом с docker-compose.yml файлик .env и записать переменные в этот файл

### Команда для сборки бекенда в докер образ

```
docker build -t termitkin/invest_backend
```

### Команда для запуска контейнера с бекендом

```
docker run -d -p 3005:3005 -p 3006:3006 --restart unless-stopped --name invest_bot -e APP_NAME=Invest_backend -e secretToken=TINKOFF_SECRET_TOKEN -e BOT_TOKEN=TELEGRAM_BOT_TOKEN -e OWNER_ID=TELEGRAM_OWNER_ID termitkin/invest_bot:latest
```
